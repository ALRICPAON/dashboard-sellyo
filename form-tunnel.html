<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Cr√©er un tunnel ‚Äì Sellyo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="dashboard.css" />
  <script type="module" src="js/firebase-auth-check.js"></script>
  <script type="module" src="js/submit-tunnel.js"></script>
</head>
<body style="background:#111;color:#fff;font-family:sans-serif;">
  <div id="navbar-container"></div>
  <script>
    fetch('navbar.html').then(r=>r.text()).then(h=>{document.getElementById('navbar-container').innerHTML=h});
  </script>

  <main style="max-width:1000px;margin:2rem auto;padding:1rem;">
    <h2 style="text-align:center;color:#00ccff;">üÜï Cr√©er un tunnel multipage</h2>

    <form id="tunnel-form" class="card" style="padding:1.25rem;display:grid;gap:1rem;">

      <!-- Bloc g√©n√©ral -->
      <fieldset class="card" style="padding:1rem;border-radius:.5rem;">
        <legend>Informations g√©n√©rales</legend>

        <label>Nom du tunnel *
          <input name="name" type="text" required />
        </label>

        <!-- (supprim√©) Objectif / description -->

        <label>Lien produit final (URL)
          <input name="redirectURL" type="url" placeholder="https://‚Ä¶" />
        </label>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem;">
          <label>Couleur principale
            <input name="mainColor" type="color" value="#00ccff" />
          </label>

          <label>Couleur des boutons
            <input name="buttonColor" type="color" value="#00ccff" />
          </label>
        </div>

        <!-- Produit digital GLOBAL -->
        <label>Produit digital global (fichier)
          <input type="file" name="digitalProductFile" accept=".pdf,.zip,.epub,.mp4,.mp3,.docx" />
          <small>Optionnel ‚Äî ebook/formation/audio √† livrer globalement (en plus d‚Äôune URL √©ventuelle).</small>
        </label>

        <!-- Uploads visuels -->
        <label>Logo
          <input type="file" name="logoFile" accept="image/*" />
          <small>Facultatif ‚Äì appara√Ætra sur toutes les pages</small>
        </label>

        <!-- (supprim√©) Image de couverture globale : chaque page a son Hero -->
      </fieldset>

      <!-- Paiement & Tracking -->
      <fieldset class="card" style="padding:1rem;border-radius:.5rem;">
        <legend>Paiement & Tracking</legend>

        <label>Prix du produit (‚Ç¨)
          <input name="payment_price" type="number" step="0.01" placeholder="49.00" />
        </label>

        <label>Devise
          <input name="currency" type="text" value="EUR" />
        </label>

        <label>Stripe Publishable Key
          <input name="stripe_pk" type="text" placeholder="pk_live_... ou pk_test_..." />
        </label>

        <label>Stripe Price ID
          <input name="stripe_price_id" type="text" placeholder="price_12345..." />
        </label>

        <label>Facebook Pixel ID
          <input name="fb_pixel" type="text" placeholder="1234567890" />
        </label>

        <label>Google Tag Manager ID
          <input name="gtm_id" type="text" placeholder="GTM-XXXXXXX" />
        </label>
      </fieldset>

      <!-- Pages dynamiques -->
      <fieldset class="card" style="padding:1rem;border-radius:.5rem;">
        <legend>Pages du tunnel (illimit√©es)</legend>
        <div id="pages-container"></div>
        <button type="button" id="add-page-btn" class="btn">‚ûï Ajouter une page</button>
      </fieldset>

      <div style="display:flex;gap:.75rem;justify-content:flex-end;">
        <a href="tunnels.html" class="btn">‚Ü©Ô∏è Retour</a>
        <button type="submit" class="btn btn-primary">‚úÖ G√©n√©rer le tunnel</button>
      </div>
    </form>
  </main>

  <!-- Template page -->
  <template id="page-template">
    <fieldset class="page-block" style="border:1px solid #333;padding:1rem;border-radius:.5rem;margin-top:1rem;">
      <legend>Page <span class="page-index"></span></legend>

      <label>Type de page
        <select name="type">
          <option value="sales">Page de vente</option>
          <option value="optin">Page de capture</option>
          <option value="checkout">Page de paiement</option>
          <option value="thankyou">Page de remerciement</option>
        </select>
      </label>

      <label>Titre
        <input name="title" type="text" />
      </label>

      <label>Sous-titre
        <input name="subtitle" type="text" />
      </label>

      <label>Image principale (Hero)
        <input type="file" name="heroImageFile" accept="image/*" />
      </label>

      <label>Vid√©o
        <input type="file" name="videoFile" accept="video/*" />
      </label>

      <!-- Description PRODUIT (par page) -->
      <label>Description du produit (si cette page vend quelque chose)
        <textarea name="productDescription" rows="3" placeholder="Description courte du produit vendu sur cette page."></textarea>
      </label>


      <!-- Bloc OPTIN -->
      <div class="optin-fields" style="display:none; margin:.5rem 0;">
        <p style="margin:.25rem 0 .5rem;opacity:.8;">Champs du formulaire (cochez ce que vous voulez demander) :</p>
        <label><input type="checkbox" name="formName"> Nom</label>
        <label><input type="checkbox" name="formFirstname"> Pr√©nom</label>
        <label><input type="checkbox" name="formEmail" checked> Email</label>
        <label><input type="checkbox" name="formPhone"> T√©l√©phone</label>
        <label><input type="checkbox" name="formAddress"> Adresse</label>
        <small>Les leads seront enregistr√©s (save-lead) lors de la g√©n√©ration.</small>
      </div>

      <!-- Bloc THANKYOU -->
      <div class="thankyou-fields" style="display:none; margin:.5rem 0;">
        <label>Texte de remerciement
          <textarea name="thankyouText" rows="3" placeholder="Merci pour votre confiance ! Consultez votre bo√Æte mail."></textarea>
        </label>
      </div>

      <label>Texte du bouton (CTA)
        <input name="ctaText" type="text" placeholder="Je commence maintenant" />
      </label>

      <label>Action du bouton
        <select name="ctaAction">
          <option value="next">Aller √† la page suivante</option>
          <option value="url">Ouvrir une URL</option>
          <option value="checkout">Paiement</option>
        </select>
      </label>

      <label>URL du bouton (si action = URL)
        <input name="ctaUrl" type="url" placeholder="https://‚Ä¶" />
      </label>

      <label style="display:block;margin-top:.5rem;">
        <input type="checkbox" class="toggle-seo"> Personnaliser le SEO sur cette page
      </label>
      <div class="seo-fields">
        <label>M√©ta titre (SEO)
          <input name="metaTitle" type="text" placeholder="Titre affich√© dans Google" />
        </label>
        <label>M√©ta description (SEO)
          <textarea name="metaDescription" rows="2" placeholder="Texte sous le titre dans Google"></textarea>
        </label>
      </div>

      <label style="display:block;margin:.5rem 0;">
  <input type="checkbox" class="toggle-extra" checked />
  Activer le contenu optionnel
</label>

<div class="extra-fields">
  <label>Probl√®me
    <textarea name="problem" rows="2"></textarea>
  </label>
  <label>Solution
    <textarea name="solution" rows="2"></textarea>
  </label>
  <label>B√©n√©fices (1 par ligne)
    <textarea name="benefits" rows="3"></textarea>
  </label>
  <label>Points cl√©s (1 par ligne)
    <textarea name="bullets" rows="3"></textarea>
  </label>
  <label>Garantie
    <input name="guarantee" type="text" placeholder="Satisfait ou rembours√© 30j" />
  </label>
  <label>T√©moignages (un par ligne)
    <textarea name="testimonials" rows="4" placeholder="Super formation !
     Tr√®s bon service !"></textarea>
  </label>
  <label>FAQ (une question par ligne)
    <textarea name="faqs" rows="4" placeholder="Comment √ßa marche ?
     Quel est le prix ?"></textarea>
  </label>
  <label>Activer timer ?
    <input name="timerEnabled" type="checkbox" />
  </label>
  <label>Dur√©e timer (minutes)
    <input name="evergreenMinutes" type="number" placeholder="20" />
  </label>
</div>
      
      <button type="button" class="btn btn-danger remove-page">üóë Supprimer cette page</button>
    </fieldset>
  </template>

  <!-- Overlay de g√©n√©ration -->
<div id="gen-overlay" style="position:fixed;inset:0;background:rgba(0,0,0,.7);backdrop-filter:blur(2px);display:none;align-items:center;justify-content:center;z-index:9999;">
  <div style="width:min(520px,92vw);background:#141414;border:1px solid #2a2a2a;border-radius:12px;padding:20px;font-family:system-ui,-apple-system,Roboto,sans-serif;color:#fff;box-shadow:0 10px 30px rgba(0,0,0,.5)">
    <h3 style="margin:0 0 8px;color:#00ccff;font-size:20px;">‚öôÔ∏è G√©n√©ration du tunnel</h3>
    <p id="gen-status" style="margin:0 0 12px;opacity:.9;">Pr√©paration‚Ä¶</p>

    <div style="display:flex;gap:10px;align-items:center;margin:12px 0;">
      <div class="spinner" style="width:18px;height:18px;border:3px solid #333;border-top-color:#00ccff;border-radius:50%;animation:spin 1s linear infinite;"></div>
      <div id="gen-step" style="font-weight:600;">Phase 1/2 ‚Äî G√©n√©ration en cours‚Ä¶</div>
    </div>

    <div style="height:8px;background:#1e1e1e;border-radius:6px;overflow:hidden;">
      <div id="gen-progress" style="height:100%;width:0%;background:linear-gradient(90deg,#00ccff,#4df);transition:width .3s;"></div>
    </div>

    <div id="gen-countdown-wrap" style="margin-top:10px;display:none;">
      <small id="gen-countdown" style="opacity:.85;">Propagation GitHub Pages : ~120s restantes‚Ä¶</small>
    </div>
  </div>
</div>

<style>
@keyframes spin { to { transform: rotate(360deg); } }
</style>

</body>
</html>
