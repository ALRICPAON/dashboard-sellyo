<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Cr√©er un Workflow ‚Äì Sellyo</title>
  <link rel="stylesheet" href="dashboard.css" />
  <script type="module" src="js/firebase-auth-check.js"></script>
  <script type="module" src="js/submit-workflow.js"></script>
  <script type="module" src="js/load-workflow-data.js"></script>
  <style>
    .email-block select {
  position: relative;
  z-index: 0; /* Ajout√© pour que le select passe SOUS le bouton üóëÔ∏è */
}

.email-block .remove-btn {
  z-index: 10; /* Par-dessus seulement le bloc */
}
    body {
      background: #111;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 2rem;
    }
    h1 {
      margin-bottom: 1rem;
    }
    label {
      display: block;
      margin: 1rem 0 0.5rem;
    }
    input, select {
      width: 100%;
      padding: 0.5rem;
      border-radius: 5px;
      border: none;
      margin-bottom: 1rem;
      background: #222;
      color: #fff;
    }
    .email-block {
      background: #1c1c1c;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
      position: relative;
      overflow: hidden;
    }
    .email-block select {
      z-index: 1;
      position: relative;
    }
    .email-block span {
      display: block;
      margin-bottom: 0.5rem;
    }
    .remove-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: #900;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0.2rem 0.6rem;
      cursor: pointer;
      z-index: 2;
    }
    .add-email-btn, .submit-btn, .back-btn {
      padding: 0.7rem 1.5rem;
      background: #0a84ff;
      border: none;
      border-radius: 5px;
      color: white;
      font-weight: bold;
      cursor: pointer;
      margin-top: 1rem;
      margin-right: 1rem;
    }
    .workflow-section {
      margin-top: 3rem;
    }
    .workflow-item {
      background: #1c1c1c;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <h1>Cr√©er un Workflow Email</h1>

  <form id="workflow-form">
    <label for="workflowName">Nom du workflow</label>
    <input type="text" id="workflowName" name="workflowName" required />

    <label for="associatedId">Associer √† une landing ou un tunnel (optionnel)</label>
    <select id="associatedId" name="associatedId">
      <option value="">Aucun</option>
      <!-- Dynamique : options ajout√©es via JS -->
    </select>

    <div id="emails-list">
      <!-- Blocs d'emails ajout√©s ici -->
    </div>

    <button type="button" class="add-email-btn" onclick="addEmailBlock()">+ Ajouter un Email</button>
    <button type="submit" class="submit-btn">Cr√©er le workflow</button>
    <a href="emails.html" class="back-btn">‚Üê Retour √† mes Emails</a>
  </form>

  <div class="workflow-section">
    <h2>Mes Workflows</h2>
    <div id="existing-workflows">
      <!-- Liste dynamique des workflows -->
    </div>
  </div>
<script>
  // Variables globales accessibles partout
  window.availableEmails = [];
  window.emailsReady = false;

  function addEmailBlock() {
    if (!window.emailsReady || availableEmails.length === 0) {
      alert("‚è≥ Les emails ne sont pas encore charg√©s. Veuillez patienter.");
      return;
    }

    const emailsList = document.getElementById('emails-list');
    const block = document.createElement('div');
    block.className = 'email-block';

    const selectOptions = availableEmails.map(email =>
      `<option value="${email.id}">${email.name}</option>`
    ).join('');

    block.innerHTML = `
      <span>Email :
        <select name="emailId[]" class="email-id">
          <option value="">-- S√©lectionner un email --</option>
          ${selectOptions}
        </select>
      </span>
      <span>D√©lai d'envoi : J+ 
        <input type="number" name="delayDays[]" class="delay-days" min="0" value="0" style="width: 60px; display: inline-block; margin-left: 5px;" />
      </span>
      <button type="button" class="remove-btn" onclick="this.parentElement.remove()">üóëÔ∏è</button>
    `;
    emailsList.appendChild(block);
  }
</script>
</body>
</html>
