<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard ‚Äì Sellyo</title>
  <link rel="stylesheet" href="dashboard.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
.button-loader {
  border: 4px solid #fff;
  border-top: 4px solid #00ccff;
  border-radius: 50%;
  width: 16px;
  height: 16px;
  animation: spin 1s linear infinite;
  display: inline-block;
  vertical-align: middle;
  margin-left: 10px;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
</style>
  <script type="module" src="js/firebase-auth-check.js"></script>
</head>
<body style="background-color: #111; color: white; font-family: sans-serif;">
  <header>
    <a href="index.html"><img src="assets/logo.png" alt="Logo Sellyo" class="logo" style="cursor: pointer;"></a>
    <nav style="display: flex; align-items: center;">
      <ul>
        <li><a href="#" id="create-tunnel">Cr√©er un tunnel</a></li>
        <li><a href="#" id="view-tunnels">Mes tunnels</a></li>
        <li><a href="#" id="view-clients">Clients</a></li>
        <li><a href="#" id="stats">Statistiques</a></li>
        <li><a href="#" id="upgrade">Passer Premium</a></li>
        <li><a href="#" id="logout">D√©connexion</a></li>
      </ul>
      <select id="lang-switch" style="margin-left: 1rem; background: #000; color: #fff; border: none; padding: 0.5rem;">
        <option value="fr">FR</option>
        <option value="en">EN</option>
      </select>
    </nav>
  </header>

  <main>
    <h1 id="welcome">Bienvenue üëã</h1>

    <!-- üî• Nouvelles donn√©es leads 7 jours -->
    <section id="leads-section" style="display: flex; gap: 2rem; margin-top: 2rem; max-width: 100%;">
  <!-- Graphique -->
  <div style="flex: 3; background: #1c1c1c; padding: 2rem; border-radius: 10px;">
  <h2>Nouveaux leads (7 derniers jours)</h2>
  <canvas id="leadsChart" width="600" height="300"></canvas>
</div>

<div style="flex: 2; background: #1c1c1c; padding: 2rem; border-radius: 10px;">
  <h2>Clients r√©cents</h2>
  <ul id="leadsList" style="padding-left: 1rem; margin: 0; list-style: none;"></ul>
</div>
</section>

    <div id="dashboard-content"></div>
    <div id="loading-message" style="display:none; margin-top: 1rem; background:#1c1c1c; padding:1rem; border-radius:8px; color:#00ccff; font-weight:bold;">
  üõ†Ô∏è G√©n√©ration en cours‚Ä¶ Votre tunnel sera pr√™t d‚Äôici 1 √† 2 minutes.
</div>

    <!-- Tunnels g√©n√©r√©s -->
    <section id="user-tunnels" style="margin-top: 2rem;">
      <h2>Mes tunnels g√©n√©r√©s</h2>
      <div id="tunnels-by-type" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1.5rem;"></div>
    </section>
    <section id="client-list-section" style="display: none; margin-top: 2rem;">
  <h2>Mes clients</h2>
  <div id="client-list" style="background: #1c1c1c; padding: 1.5rem; border-radius: 10px;"></div>
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
  <div>
    <label for="filter-type">Filtrer :</label>
    <select id="filter-type" style="background: #000; color: #fff; border: none; padding: 0.4rem;">
      <option value="">Tous</option>
      <option value="tunnel">Tunnel</option>
      <option value="landing">Landing</option>
      <option value="email">Email</option>
      <option value="video">Vid√©o</option>
    </select>
  </div>
  <button id="export-csv" style="background: #00ccff; color: #000; padding: 0.5rem 1rem; border: none; border-radius: 6px;">üìÅ Exporter CSV</button>
</div>
</section>

    <!-- Formulaire -->
    <div id="create-tunnel-form" style="display: none; background: #2e2e2e; padding: 2rem; border-radius: 10px; max-width: 600px; width: 100%; box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);">
      <h2>Cr√©er un contenu</h2>
      <form id="tunnel-form">
        <label>Identifiant public *</label><br>
        <input type="text" id="folderName" required><br><br>

        <label>Nom de la page *</label><br>
        <input type="text" id="slug" required><br>
        <small style="color:#aaa;">L'extension <strong>.html</strong> sera g√©r√©e automatiquement</small><br><br>

        <label>Type de contenu *</label><br>
        <select id="tunnel-type" required>
          <option value="" disabled selected>Choisir...</option>
          <option value="complet">Tunnel Complet</option>
          <option value="landing">Landing page seule</option>
          <option value="email">Email de relance</option>
          <option value="video">Script vid√©o</option>
        </select><br><br>

        <div id="form-content-fields"></div>

        <label>Couleur principale du bouton</label><br>
        <input type="color" id="mainColor" value="#00ccff"><br><br>

        <label>Couleur de fond</label><br>
        <input type="color" id="backgroundColor" value="#111111"><br><br>

        <button type="submit" id="generate-button">G√©n√©rer <span id="loader-zone"></span></button>
      </form>
    </div>

    <!-- Tunnel complet -->
    <div id="form-tunnel-complet" style="display: none; background: #2e2e2e; padding: 2rem; border-radius: 10px; max-width: 700px; width: 100%; margin-top: 2rem;">
      <h2>Tunnel Complet ‚Äì Pages personnalis√©es</h2>

      <label>Logo de la marque</label><br>
      <input type="file" id="full-logo" accept="image/*"><br><br>

      <label>Couleur de fond</label><br>
      <input type="color" id="full-background-color" value="#121212"><br><br>

      <label>Couleur du bouton</label><br>
      <input type="color" id="full-button-color" value="#ff9900"><br><br>

      <label>Vid√©o principale</label><br>
      <input type="file" id="full-video" accept="video/*"><br><br>

      <label>URL globale (bouton final)</label><br>
      <input type="url" id="full-main-url"><br><br>

      <div id="tunnel-pages-complet"></div>

      <button type="button" id="add-page-full">+ Ajouter une page</button><br><br>
      <button type="button" id="submit-full-tunnel">G√©n√©rer le tunnel complet</button>
    </div>
  </main>

  <script type="module" src="js/tunnel-submit.js"></script>
  <script type="module" src="js/dashboard.js"></script>

  <script>
  document.getElementById("create-tunnel").addEventListener("click", () => {
    const form = document.getElementById("tunnel-form");
    const fullForm = document.getElementById("form-tunnel-complet");
    const formFields = document.getElementById("form-content-fields");
    const tunnelPages = document.getElementById("tunnel-pages-complet");

    if (form) form.reset();
    if (formFields) formFields.innerHTML = "";
    if (tunnelPages) tunnelPages.innerHTML = "";
    if (fullForm) fullForm.style.display = "none";

    // üëâ Cacher le graphique + leads
    document.getElementById("leads-section").style.display = "none";

    document.getElementById("create-tunnel-form").style.display = "block";
    window.scrollTo(0, 0);
  });
</script>
<script>
  // Si on revient depuis le submit avec ?tunnel=1 ‚Üí afficher le message
  const params = new URLSearchParams(window.location.search);
  if (params.get("tunnel") === "1") {
    document.getElementById("leads-section").style.display = "none";
    document.getElementById("create-tunnel-form").style.display = "none";
    document.getElementById("form-tunnel-complet").style.display = "none";
    document.getElementById("client-list-section").style.display = "none";
    document.getElementById("user-tunnels").style.display = "none";

    const loadingMsg = document.getElementById("loading-message");
    loadingMsg.innerHTML = "üõ†Ô∏è G√©n√©ration en cours‚Ä¶ Votre tunnel sera visible ici dans moins de 2 minutes...";
    loadingMsg.style.display = "block";
    // Supprimer le param√®tre ?tunnel=1 de l'URL sans recharger
const newUrl = window.location.origin + window.location.pathname;
window.history.replaceState({}, document.title, newUrl);

   // ‚è± Affiche le second message apr√®s 1min30 et recharge les tunnels
setTimeout(() => {
  loaderZone.innerHTML = '';
  loadingMsg.innerHTML = "‚úÖ Votre tunnel est pr√™t ! Cliquez sur l‚Äôonglet <strong>Mes tunnels</strong> pour le d√©couvrir.";

  // Recharge les tunnels sans reload
  import('./js/dashboard.js').then(module => {
    if (module.reloadTunnels) {
      module.reloadTunnels();
    }
  });
}, 90000);

  // Cacher le message quand on clique sur "Mes tunnels"
  const viewTunnelsBtn = document.getElementById("view-tunnels");
  if (viewTunnelsBtn) {
    viewTunnelsBtn.addEventListener("click", () => {
      const msg = document.getElementById("loading-message");
      if (msg) msg.style.display = "none";
    });
  }
</script>
</body>
</html>
